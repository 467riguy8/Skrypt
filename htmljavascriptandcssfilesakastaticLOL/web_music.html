<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta property="og:description" content="SkellySKripts is a very clean and fast proxy" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://raw.githubusercontent.com/razzlerazing2/SkellyScript/refs/heads/main/IMG_3642.webp" type="image/x-icon" />
    <title>Web Music - SKrypt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/web_music.css"> <!-- Link to the new web music specific CSS -->

    <style>
        /* Your existing theme styles - Keep these here as they modify the body background */
        body[theme="cuhs"] {
            background: url("/assets/media/background/poppingthatGTV.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="cuhs2"] {
            background: url("/assets/media/background/stadning.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="cuhs3"] {
            background: url("/assets/media/background/Pacificthatis.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-frappe"] {
            background: url("/assets/media/background/skibididdy.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-macchiato"] {
            background: url("/assets/media/background/rizzyaf.gif") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-mocha"] {
            background: url("/assets/media/background/senkbucketup.webp") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="default"] {
            background: url("/assets/media/background/canthurtmewmyogscantnerfmesandyop.png") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        /* --- Intro Animation CSS (reused) --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a2e; /* A dark background, adjust to match your theme */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        #preloader.hidden {
            opacity: 0;
            pointer-events: none; /* Allows clicks to pass through once hidden */
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .animated-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .animated-content.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <nav class="animated-content">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="/home"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="/games"><i class="fas fa-gamepad"></i> Games</a></li>
                <li><a href="/apps"><i class="fas fa-mobile-alt"></i> Apps</a></li>
                <li><a href="/settings"><i class="fas fa-cogs"></i> Settings</a></li>
                <li><a href="/web_music.html"><i class="fas fa-music"></i> Web Music</a></li> <!-- New Web Music link -->
            </ul>
        </div>
    </nav>

    <div class="container animated-content">
        <div class="overlay"></div>
        <div class="container-inner">
            <h1><span class="highlight">Web Music Player</span></h1>
            <p class="music-description">Enjoy a curated selection of music directly in your browser!</p>

            <div class="input-c">
                <input type="text" id="music-search" onkeyup="searchMusic()" placeholder="Search songs..." />
            </div>

            <div id="music-player-controls">
                <audio id="audio-player" controls autoplay></audio>
                <div class="player-info">
                    <span id="current-song-title">Select a song to play</span>
                </div>
                <div class="player-buttons">
                    <button id="prev-button" title="Previous Song"><i class="fas fa-backward"></i></button>
                    <button id="play-pause-button" title="Play/Pause"><i class="fas fa-play"></i></button>
                    <button id="next-button" title="Next Song"><i class="fas fa-forward"></i></button>
                </div>
            </div>

            <div id="music-list">
                <!-- Music items will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Apply saved theme on page load
        const savedTheme = localStorage.getItem('theme') || 'cuhs3';
        document.body.setAttribute('theme', savedTheme);

        // Define the setTheme function globally
        function setTheme(theme) {
            document.body.setAttribute('theme', theme);
            localStorage.setItem('theme', theme);
        }

        // --- Intro Animation JavaScript (reused) ---
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            const animatedElements = document.querySelectorAll('.animated-content');

            setTimeout(() => {
                preloader.classList.add('hidden');
                animatedElements.forEach(element => {
                    element.classList.add('show');
                });

                // --- JavaScript for Active Navigation Link ---
                const navLinks = document.querySelectorAll('.nav-links li a');
                const currentPath = window.location.pathname;

                navLinks.forEach(link => {
                    const normalizedCurrentPath = currentPath.endsWith('/') && currentPath.length > 1
                        ? currentPath.slice(0, -1)
                        : currentPath;

                    const normalizedLinkPath = link.pathname.endsWith('/') && link.pathname.length > 1
                        ? link.pathname.slice(0, -1)
                        : link.pathname;

                    if (normalizedLinkPath === normalizedCurrentPath ||
                        (normalizedLinkPath === '/home' && normalizedCurrentPath === '/')) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }, 500);
        });

        // --- Web Music Player JavaScript ---
        const audioPlayer = document.getElementById('audio-player');
        const playPauseButton = document.getElementById('play-pause-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const currentSongTitle = document.getElementById('current-song-title');
        const musicListDiv = document.getElementById('music-list');
        const musicSearchInput = document.getElementById('music-search');

        // Define your playlist here
        const allSongs = [ // Renamed to allSongs to distinguish from filtered playlist
            { name: "Chill Lo-Fi Beat", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { name: "Upbeat Corporate Groove", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { name: "Relaxing Ambient Track", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { name: "Acoustic Breeze", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
            { name: "Energetic Pop", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" },
            { name: "Smooth Jazz Fusion", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3" },
            { name: "Dreamy Synthwave", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" },
            { name: "Inspiring Cinematic", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
            { name: "Funky Disco Groove", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" },
            { name: "Calm Piano Melody", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" },
            // Add more songs here
            // Example: { name: "My Awesome Song", url: "/assets/music/my_awesome_song.mp3" },
        ];

        let filteredPlaylist = [...allSongs]; // Initialize with all songs
        let currentSongIndex = 0;

        function loadSong(index) {
            if (filteredPlaylist.length === 0) {
                audioPlayer.src = '';
                currentSongTitle.textContent = 'No songs in playlist';
                playPauseButton.disabled = true;
                prevButton.disabled = true;
                nextButton.disabled = true;
                return;
            }

            currentSongIndex = (index + filteredPlaylist.length) % filteredPlaylist.length; // Ensure index wraps around
            const song = filteredPlaylist[currentSongIndex];
            audioPlayer.src = song.url;
            currentSongTitle.textContent = song.name;
            audioPlayer.play().catch(error => {
                console.error("Autoplay prevented:", error);
                // Optionally show a message to the user to manually play
            });
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>'; // Set to pause icon
            updateActiveSongInList();
            playPauseButton.disabled = false;
            prevButton.disabled = false;
            nextButton.disabled = false;
        }

        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audioPlayer.pause();
                playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function playNextSong() {
            loadSong(currentSongIndex + 1);
        }

        function playPrevSong() {
            loadSong(currentSongIndex - 1);
        }

        function renderMusicList() {
            musicListDiv.innerHTML = ''; // Clear existing list
            if (filteredPlaylist.length === 0) {
                musicListDiv.innerHTML = '<p class="no-music-message">No matching music found. Try a different search!</p>';
                return;
            }

            filteredPlaylist.forEach((song, index) => {
                const musicItem = document.createElement('div');
                musicItem.classList.add('music-item');
                musicItem.setAttribute('data-index', index); // Use index within filteredPlaylist
                musicItem.innerHTML = `
                    <div class="music-info">
                        <i class="fas fa-music"></i>
                        <span>${song.name}</span>
                    </div>
                    <div class="item-actions">
                        <button class="play-song-btn" title="Play this song"><i class="fas fa-play"></i></button>
                        <button class="ai-analyze-btn" title="Get AI Analysis ✨"><i class="fas fa-magic"></i></button>
                    </div>
                    <div class="ai-analysis-output hidden">
                        <p class="loading-analysis hidden">Analyzing...</p>
                        <p class="analysis-text"></p>
                    </div>
                `;
                musicListDiv.appendChild(musicItem);

                // Add event listener to play specific song
                musicItem.querySelector('.play-song-btn').addEventListener('click', () => {
                    loadSong(index);
                });

                // Add event listener for AI analysis button
                musicItem.querySelector('.ai-analyze-btn').addEventListener('click', (event) => {
                    getSongAnalysis(song.name, event.currentTarget);
                });
            });
            updateActiveSongInList(); // Highlight the currently playing song
        }

        function updateActiveSongInList() {
            document.querySelectorAll('.music-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`.music-item[data-index="${currentSongIndex}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        // --- Search Functionality ---
        function searchMusic() {
            const searchTerm = musicSearchInput.value.toLowerCase();
            filteredPlaylist = allSongs.filter(song =>
                song.name.toLowerCase().includes(searchTerm)
            );
            // After filtering, re-render the list
            renderMusicList();

            // If the currently playing song is no longer in the filtered list,
            // or if the filtered list is empty, reset the player.
            const currentSong = filteredPlaylist[currentSongIndex];
            if (!currentSong || !currentSong.name.toLowerCase().includes(searchTerm)) {
                if (filteredPlaylist.length > 0) {
                    loadSong(0); // Load the first song of the filtered list
                } else {
                    audioPlayer.pause();
                    audioPlayer.src = '';
                    currentSongTitle.textContent = 'No songs in playlist';
                    playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
                    playPauseButton.disabled = true;
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                }
            } else {
                updateActiveSongInList(); // Ensure highlight is correct for current song
            }
        }

        // --- AI Song Analysis Functionality ---
        async function getSongAnalysis(songName, buttonElement) {
            const musicItem = buttonElement.closest('.music-item');
            const analysisOutput = musicItem.querySelector('.ai-analysis-output');
            const loadingAnalysis = musicItem.querySelector('.loading-analysis');
            const analysisText = musicItem.querySelector('.analysis-text');

            // Toggle visibility if already open
            if (!analysisOutput.classList.contains('hidden') && analysisText.textContent !== '') {
                analysisOutput.classList.add('hidden');
                analysisText.textContent = ''; // Clear content when hiding
                return;
            }

            analysisOutput.classList.remove('hidden');
            loadingAnalysis.classList.remove('hidden');
            analysisText.textContent = ''; // Clear previous text
            buttonElement.disabled = true; // Disable button during analysis

            const prompt = `Provide a brief (2-3 sentences), creative description and suggest a mood/vibe for the song titled "${songName}". Focus on general musical characteristics or feelings it evokes.`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // Leave this as-is; Canvas will provide it at runtime.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Gemini API Error:", response.status, response.statusText, errorData);
                    analysisText.textContent = `Error: Could not get analysis. ${errorData.error.message || 'Please try again.'}`;
                    return;
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    analysisText.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    analysisText.textContent = "Could not generate analysis for this song.";
                    console.error("Unexpected Gemini API response structure:", result);
                }
            } catch (error) {
                console.error("Network or API Call Error:", error);
                analysisText.textContent = "Failed to connect to AI. Check your internet connection.";
            } finally {
                loadingAnalysis.classList.add('hidden');
                buttonElement.disabled = false; // Re-enable button
            }
        }


        // Event Listeners for player controls
        playPauseButton.addEventListener('click', togglePlayPause);
        prevButton.addEventListener('click', playPrevSong);
        nextButton.addEventListener('click', playNextSong);
        audioPlayer.addEventListener('ended', playNextSong); // Auto-play next song when current ends
        musicSearchInput.addEventListener('keyup', searchMusic); // Listen for search input

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            renderMusicList();
            loadSong(currentSongIndex); // Load the first song
            // Pause initially if autoplay is prevented
            audioPlayer.addEventListener('canplaythrough', () => {
                if (audioPlayer.paused && audioPlayer.currentTime === 0) {
                    playPauseButton.innerHTML = '<i class="fas fa-play"></i>'; // Show play icon if not autoplaying
                }
            }, { once: true });
        });

        // Update play/pause button icon based on audio player state
        audioPlayer.addEventListener('play', () => {
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
        });
        audioPlayer.addEventListener('pause', () => {
            playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
        });
    </script>
</body>

</html>
