<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta property="og:description" content="SkellySKripts is a very clean and fast proxy" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://raw.githubusercontent.com/razzlerazing2/SkellyScript/refs/heads/main/IMG_3642.webp" type="image/x-icon" />
    <title>AI Chat - SKrypt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/ai.css"> <!-- Link to the new AI chat specific CSS -->

    <style>
        /* Your existing theme styles - Keep these here as they modify the body background */
        body[theme="cuhs"] {
            background: url("/assets/media/background/poppingthatGTV.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="cuhs2"] {
            background: url("/assets/media/background/stadning.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="cuhs3"] {
            background: url("/assets/media/background/Pacificthatis.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-frappe"] {
            background: url("/assets/media/background/skibididdy.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-macchiato"] {
            background: url("/assets/media/background/rizzyaf.gif") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="catppuccin-mocha"] {
            background: url("/assets/media/background/senkbucketup.webp") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        body[theme="default"] {
            background: url("/assets/media/background/canthurtmewmyogscantnerfmesandyop.png") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
        }

        /* --- Intro Animation CSS (reused) --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a2e; /* A dark background, adjust to match your theme */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        #preloader.hidden {
            opacity: 0;
            pointer-events: none; /* Allows clicks to pass through once hidden */
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .animated-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .animated-content.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <nav class="animated-content">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="/home"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="/games"><i class="fas fa-gamepad"></i> Games</a></li>
                <li><a href="/apps"><i class="fas fa-mobile-alt"></i> Apps</a></li>
                <li><a href="/settings"><i class="fas fa-cogs"></i> Settings</a></li>
                <li><a href="/ai.html"><i class="fas fa-robot"></i> AI Chat</a></li> <!-- New AI Chat link -->
            </ul>
        </div>
    </nav>

    <div class="container animated-content">
        <div class="overlay"></div>
        <div class="container-inner">
            <h1><span class="highlight">AI Chat</span></h1>
            <p class="chat-description">Ask me anything! I'm powered by Skrypt.</p>

            <div id="chat-messages">
                <!-- Chat messages will be appended here by JavaScript -->
                <div class="message ai-message">
                    <p>Hello! How can I assist you today?</p>
                </div>
            </div>

            <div class="chat-input-area">
                <input type="text" id="user-input" placeholder="Type your message..." />
                <button id="send-button"><i class="fas fa-paper-plane"></i> Send</button>
            </div>
            <div id="loading-indicator" class="hidden">Thinking...</div>
        </div>
    </div>

    <!-- General scripts -->
    <script src="/assets/js/i.js?v=03"></script>

    <script>
        // Apply saved theme on page load
        const savedTheme = localStorage.getItem('theme') || 'cuhs3';
        document.body.setAttribute('theme', savedTheme);

        // Define the setTheme function globally
        function setTheme(theme) {
            document.body.setAttribute('theme', theme);
            localStorage.setItem('theme', theme);
        }

        // --- Intro Animation JavaScript (reused) ---
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            const animatedElements = document.querySelectorAll('.animated-content');

            setTimeout(() => {
                preloader.classList.add('hidden');
                animatedElements.forEach(element => {
                    element.classList.add('show');
                });
            }, 500);
        });

        // --- AI Chat JavaScript ---
        const chatMessagesDiv = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const loadingIndicator = document.getElementById('loading-indicator');

        let chatHistory = []; // Stores conversation for context

        // Function to display messages in the chat interface
        function displayMessage(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            messageElement.innerHTML = `<p>${message}</p>`;
            chatMessagesDiv.appendChild(messageElement);
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Auto-scroll to bottom
        }

        // Function to send message to Gemini API
        async function sendMessage() {
            const prompt = userInput.value.trim();
            if (!prompt) return; // Don't send empty messages

            displayMessage(prompt, 'user'); // Display user's message immediately
            userInput.value = ''; // Clear input field
            userInput.disabled = true; // Disable input while waiting for response
            sendButton.disabled = true;
            loadingIndicator.classList.remove('hidden'); // Show loading indicator

            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            // IMPORTANT: If you are running this outside of a Canvas environment
            // that automatically injects the API key, you might need to
            // paste your Gemini API key here for testing purposes.
            // Example: const apiKey = "YOUR_GEMINI_API_KEY_HERE";
            // Make sure to remove it before public deployment!
            const apiKey = ""; // Leave this as-is; Canvas will provide it at runtime.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // Check for HTTP errors (e.g., 400, 401, 403, 404, 500)
                if (!response.ok) {
                    const errorData = await response.json(); // Try to parse error details
                    console.error("API Error:", response.status, response.statusText, errorData);
                    displayMessage(`Error: ${errorData.error.message || 'Failed to get response from AI. Check console for details.'}`, 'ai');
                    return; // Stop execution
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponse = result.candidates[0].content.parts[0].text;
                    displayMessage(aiResponse, 'ai');
                    chatHistory.push({ role: "model", parts: [{ text: aiResponse }] }); // Add AI response to history
                } else {
                    displayMessage("Sorry, I couldn't get a valid response. The AI might be having trouble.", 'ai');
                    console.error("Unexpected API response structure:", result);
                }
            } catch (error) {
                console.error("Network or API Call Error:", error);
                displayMessage("An error occurred. Please check your network connection or console for details.", 'ai');
            } finally {
                userInput.disabled = false; // Re-enable input
                sendButton.disabled = false;
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
                userInput.focus(); // Focus input for next message
            }
        }

        // Event listeners for sending messages
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // This JavaScript snippet to add the nav link is redundant if the HTML is static.
        // If your nav is dynamically built, you might need it, but for static HTML, it's already there.
        // const navLinks = document.querySelector('.nav-links');
        // const newNavLink = document.createElement('li');
        // newNavLink.innerHTML = '<a href="/ai.html"><i class="fas fa-robot"></i> AI Chat</a>';
        // navLinks.appendChild(newNavLink);
    </script>
</body>

</html>
